angular.module("artJoystick",[]),angular.module("artJoystick").factory("artJoystickExternal",function(){return{}}).directive("artJoystick",["$parse","$document","$timeout","$compile","artJoystickExternal",function(a,b,c,d,e){return{restrict:"E",scope:{sendMovement:"&",cordovaEnabled:"=",vibrationEnabled:"=",speedIncrease:"=",maxPositiveSpeed:"=",maxNegativeSpeed:"=",directionManagement:"=",controlSize:"="},transclude:!1,templateUrl:"angular-joystick.html",controller:function(a,b,c){c.goBackToLevel=function(a){console.log("direction",a)}},link:function(a,b,d){var e=angular.element(b[0].querySelector(".art-joystick")),f=(b[0].querySelector(".art-pad"),{center:[e[0].offsetLeft,e[0].offsetTop],moving:0,directiveOffset:[b[0].offsetLeft,b[0].offsetTop],touchedCenter:[]});e.css({left:f.center[0]+"px"}),e.css({top:f.center[1]+"px"});var g=0,h=function(a){var b=a[g][0];k(b.clientX,b.clientY)};e.on("touchstart",function(a){f.moving=1,console.log("touchstart",a);var b=[];a.originalEvent?(b=a.originalEvent.touches[0]||a.originalEvent.changedTouches[0],g="originalEvent"):a.targetTouches?(b=a.targetTouches[0],g="targetTouches"):a.changedTouches&&(b=a.changedTouches[0],g="changedTouches"),f.touchedCenter=[b.clientX,b.clientY],e.on("touchmove",h)}),angular.element(window).on("touchend",function(a){console.log("touchend",a),f.moving=0,l(e),e.off("touchmove",h)});var i=function(a){k(a.clientX,a.clientY)};e.on("mousedown",function(a){console.log("mousedown",a),f.moving=1,f.touchedCenter=[a.clientX,a.clientY],e.on("mousemove",i)}),angular.element(window).on("mouseup",function(a){console.log("mouseup",a),f.moving=0,l(e),e.off("mousemove",i)}),a.$watch(function(){return e[0].offsetLeft},function(a,b){}),a.$watch(function(){return e[0].offsetTop},function(a,b){});var j=function(a,b){var c=a[0]/1.5,d=Math.sqrt(c*c-b[0]*b[0]),e=Math.sqrt(c*c-b[1]*b[1]);return console.log("xlim",d,"ylim",e),d>0&&e>0?!0:!1},k=function(b,c){var d={x:parseInt(e.css("left").replace("px",""))-f.center[0],y:parseInt(e.css("top").replace("px",""))-f.center[1]};if(j(f.center,[d.x,d.y])){var g=b-f.touchedCenter[0],h=c-f.touchedCenter[1];e.css({left:f.center[0]+g+"px"}),e.css({top:f.center[1]+h+"px"}),a.$apply()}else console.log("outside :( "),e[0].blur()},l=function(a){a.addClass("returning"),c(function(){f.moving?a.removeClass("returning"):a.css({left:f.center[0]+"px",top:f.center[1]+"px"})},500),c(function(){a.removeClass("returning")},1e3)}}}}]),angular.module("artJoystick").run(["$templateCache",function(a){"use strict";a.put("angular-joystick.html",'<div class="art-joystick-container">\n    <div class="art-pad"></div>\n    <div class="art-joystick">\n        <div class="art-button"></div>\n    </div>\n\n</div>')}]);